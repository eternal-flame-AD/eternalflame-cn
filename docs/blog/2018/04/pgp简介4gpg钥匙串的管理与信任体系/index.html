<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    

    <base href="https://eternalflame.cn/">
    <title>【PGP简介】（4）gpg钥匙串的管理与信任体系 | eternal-flame-AD</title>
    <link rel="canonical" href="https://eternalflame.cn/blog/2018/04/pgp%E7%AE%80%E4%BB%8B4gpg%E9%92%A5%E5%8C%99%E4%B8%B2%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BF%A1%E4%BB%BB%E4%BD%93%E7%B3%BB/">
    

    
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>




<link rel="stylesheet" href="https://eternalflame.cn/style.css" />



<script src="/js/anime.min.js"></script>
<script async src="/js/fireworks.js"></script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
</head>
<body lang="en">
    <nav class="navbar navbar-default navbar-expand-lg navbar-light bg-light">
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav-main" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav-main">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
            <li class="nav-item active"><a href="/blog/" class="nav-link">Blog</a></li>
            <li class="nav-item"><a href="https://github.com/eternal-flame-AD" class="nav-link">Github</a></li>
            <li class="nav-item"><a href="https://connect.garmin.com/modern/profile/67225a8f-1f19-491b-ae65-274a76fe0ba1" class="nav-link">Garmin Connect</a></li>
            <li class="nav-item"><a href="https://keybase.io/eternal_flame" class="nav-link">Keybase</a></li>
        </ul>
        <button class="btn btn-primary my-2 my-sm-0" onClick="javascript::window.location.href='https://github.com/eternal-flame-AD'"><i class="fab fa-github"></i>Follow me on Github</button>
    </div>
</nav>
    <div class="container">
        <div class="jumbotron jumbotron-narrow">
            <h3 class="display-4">【PGP简介】（4）gpg钥匙串的管理与信任体系</h3>
            <i class="text-muted"><i class="fas fa-user"></i>Eternal-flame-AD</i> <br />
            <i class="text-muted"><i class="fas fa-clock"></i>Thu, Apr 5, 2018</i> <br />
            
            <i class="text-muted"><i class="fas fa-shapes"></i><a href="/categories/%e6%8a%80%e6%9c%af">技术&nbsp;</a><a href="/categories/%e6%97%a5%e5%b8%b8">日常&nbsp;</a></i> <br />
            <i class="text-muted"><i class="fas fa-link"></i><a style="word-wrap: break-word;" href="https://eternalflame.cn/blog/2018/04/pgp%E7%AE%80%E4%BB%8B4gpg%E9%92%A5%E5%8C%99%E4%B8%B2%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BF%A1%E4%BB%BB%E4%BD%93%E7%B3%BB/">https://eternalflame.cn/blog/2018/04/pgp%E7%AE%80%E4%BB%8B4gpg%E9%92%A5%E5%8C%99%E4%B8%B2%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BF%A1%E4%BB%BB%E4%BD%93%E7%B3%BB/</a></i> <br />
            <i class="text-muted"><i class="fas fa-copyright"></i><a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-NC 4.0</a></i> <br />
            <i class="text-muted"><i class="fas fa-comment"></i><a href="https://eternalflame.cn/blog/2018/04/pgp%E7%AE%80%E4%BB%8B4gpg%E9%92%A5%E5%8C%99%E4%B8%B2%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BF%A1%E4%BB%BB%E4%BD%93%E7%B3%BB/#disqus_thread">Comments</a></i> <br />
            
            
        </div>
        <article>
        <p>在我们实际使用PGP进行通讯的时候，首先就有一个非常核心的问题：我们究竟如何来管理自己所拥有的密钥呢？ PGP使用了一个钥匙串的体系来管理用户的密钥。下面我用gpg程序演示：</p>

<p>我们可以通过<code>gpg --list-keys</code>命令或者图形界面来查看钥匙串中的公钥，<code>gpg --list-secret-keys</code>来查看私钥：</p>

<p>下面我们来看一个pgp公钥记录（这是我的公钥~）</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-INI" data-lang="INI"><span style="color:#a6e22e">pub rsa4096 2018-01-19 [SCA] [expires: 2019-01-19]</span>
<span style="color:#a6e22e">356982FADCBDDC60DBAD25E84CBBC48C2F2FF36B</span>
<span style="color:#a6e22e">uid [ultimate] Eternal_flame-AD_extend (extended) &amp;lt;eternal_flame-AD@protonmail.com&amp;gt;</span>
<span style="color:#a6e22e">uid [ultimate] Eternal_flame-AD(extended) &amp;lt;eternal_flame-AD@protonmail.com&amp;gt;</span>
<span style="color:#a6e22e">sub rsa4096 2018-01-19 [E] [expires: 2019-01-19]</span></code></pre></div>

<p>我们看到，这个公钥有两个用户标识（uid），还有一个子密钥，2018-01-19生效，有效期到2019-01-19，使用的是rsa4096，上面可以看到我的名称和email地址，[ultimate]这个密钥因为被赋予了ultimate级别的信任所以有效性也是绝对可靠的（因为这是我自己的密钥= = <strong>不要给予任何外来的密钥最高信任</strong>）</p>

<p>关于信任级别的问题，可以使用<code>gpg edit-keys [uid]</code>进入密钥编辑后查看，我们来看这个密钥（因为是别人的所以我隐藏了指纹和用户标识）：</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-INI" data-lang="INI"><span style="color:#a6e22e">pub  rsa4096/XXXXXXXXXXXXXX</span>
     <span style="color:#a6e22e">created: 2018-02-26  expires: never       usage: C</span>
     <span style="color:#a6e22e">trust: never         validity: full</span>
<span style="color:#a6e22e">sub  rsa2048/XXXXXXXXXXXX</span>
     <span style="color:#a6e22e">created: 2018-02-26  expires: 2026-02-24  usage: E</span>
<span style="color:#a6e22e">sub  rsa2048/XXXXXXXXXXXXX</span>
     <span style="color:#a6e22e">created: 2018-02-26  expires: 2026-02-24  usage: SA</span>
<span style="color:#a6e22e">[  full  ] (1). XXXXXXX &lt;XXXXXXXXX;</span></code></pre></div>

<p>可以看到trust（信任）一栏是never，validity（有效性）是full，这两个有什么区别呢？首先要从validity说起，validity指的是对一个密钥的有效性的说明，是由gpg程序计算出的，而非用户指派，一个密钥要被认为是有效的，就必须满足以下的条件：</p>

<ul>
<li>密钥在有效期内</li>
<li>密钥没有被吊销（吊销属于密钥操作，之后会说到）</li>
<li>密钥已经被另一个full级别或ultimate级别trust的密钥签名，或被多个（通常是3个）以上的marginal级别trust的密钥签名</li>
</ul>

<p>上面的前两个应该比较简洁，第三个就要补充一个知识点了：我之前说到私钥可以给信息签名，这里的签名，不仅仅是对我发出的消息进行签名，还可以对其它的公钥进行签名，以此表明签名者认为该公钥是有效的。例如，你收到了来自朋友的一个公钥，你再将它导入钥匙串之后，gpg程序默认是不认为这个公钥有效的，只有你自己面对面或使用其他可靠方式确认公钥有效性以后，你使用自己的私钥（ultimate级别信任）签名之后，这个公钥才能在钥匙串中被标为有效。而对于full和marginal级别密钥签名的其他密钥，gpg分别有一套处理方法：这里就要说到密钥的trust了，gpg一共有一下五种trust级别，可以在编辑trust时看到：</p>

<pre>Please decide how far you trust this user to correctly verify other users' keys
(by looking at passports, checking fingerprints from different sources, etc.)

  1 = I don't know or won't say
  2 = I do NOT trust
  3 = I trust marginally
  4 = I trust fully
  5 = I trust ultimately
</pre>

<p>当你试图更改你对一个公钥的trust时，gpg会提示上面这个消息。</p>

<ol>
<li>我不知道这个密钥是否可信，这是新导入的公钥的默认信任度。</li>
<li>我不信任这个密钥，例如这是一个陌生人的公钥，你认为他不一定能够做到在对密钥签名前进行可靠的验证，因此他有可能有意或无意地给伪造的密钥签名，所以其它密钥不应当因为被他的密钥签名而得到有效性上的验证。可能有些绕，我再理一下，比如Alice收到了Bob的公钥，他们见面核对了签名，因此Alice用自己的私钥对Bob的公钥进行了签名，Bob的公钥因此就在Alice的钥匙串上被认为是有效的了，然而Alice认为Bob不是很会用pgp，有可能随便给别人的密钥签名，所以给予了none(2)的信任级别，果然有一天Bob在没有经过验证的情况下签名了Eve伪造的Charlie的密钥，并且将签名后的密钥传到了hkp服务器上（管理pgp密钥的公用服务器），但这个伪造的Charlie的密钥虽然经过Bob公钥的签名，仍然不会通过Alice钥匙串的有效性验证，因为gpg认为none(2)级别的密钥签名的其他密钥不一定有效。</li>
<li>边际信任。我不认为这个人签出的其他密钥100%有效，但如果一个密钥被三个或三个以上边际信任的密钥签名，那么有理由相信这个密钥是有效的。这是我比较经常使用的选项，一般用于较为熟悉的人。</li>
<li>完全信任。如果该密钥被认为有效，那么它签出的其他密钥都将被认为是有效的（和ultimate接近）。一般用于非常信任的人之间。</li>
<li>最高信任。不论该密钥当前计算结果是否是有效，它签出的其他密钥都被认为有效。一般只用于自己的密钥。</li>
</ol>

        </article>
        <div id="disqus_thread"></div>
<script>



var disqus_config = function () {
this.page.url = "https:\/\/eternalflame.cn\/blog\/2018\/04\/pgp%E7%AE%80%E4%BB%8B4gpg%E9%92%A5%E5%8C%99%E4%B8%B2%E7%9A%84%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BF%A1%E4%BB%BB%E4%BD%93%E7%B3%BB\/";  
this.page.identifier = "7757567a29071ac67024eea088eec76d"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://eternalflame-cn.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
    </div>
<script id="dsq-count-scr" src="//eternalflame-cn.disqus.com/count.js" async></script>
    </body>
</html>